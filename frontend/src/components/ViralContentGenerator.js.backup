import React, { useState, useEffect, useCallback } from 'react';
import { motion } from 'framer-motion';
import { useNavigate, useParams } from 'react-router-dom';
import api from '../utils/api';
import toast from 'react-hot-toast';

const ViralContentGenerator = () => {
  const { propertyId } = useParams();
  const navigate = useNavigate();
  const [loading, setLoading] = useState(true);
  const [generating, setGenerating] = useState(false);
  const [content, setContent] = useState([]);
  const [selectedPlatform, setSelectedPlatform] = useState('instagram');


  const loadContent = useCallback(async () => {
    try {
      setLoading(true);
      const data = await api.viralContent.get(propertyId);

      if (data.length === 0) {
        await generateContent();
      } else {
        setContent(data);
      }
    } catch (error) {
      console.error('Error loading content:', error);
      toast.error('Failed to load content');
    } finally {
      setLoading(false);
    }
  }, [propertyId]);

  const generateContent = useCallback(async () => {
    try {
      setGenerating(true);
      toast.loading('Generating viral content with AI...', { id: 'generate' });

      const result = await api.viralContent.generate(propertyId);

      setContent(result.content);
      toast.success('Viral content generated!', { id: 'generate' });
    } catch (error) {
      console.error('Error generating content:', error);
      toast.error('Failed to generate content', { id: 'generate' });
    } finally {
      setGenerating(false);
    }
  }, [propertyId]);

